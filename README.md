# 30.1 Вьюсеты и дженерики
# Задача 1 ViewSet
1. Создать модель «Список машин» и реализовать механизм CRUD на основе ViewSet.

Шаги решения:
- Создать модель.
1. Создаем новое приложение vehicle. Вносим в config/settings/installed_apps
2. Создаем модель в vehicle/models
3. создать миграции

- Описать сериализатор.
4. создать в приложении vehicle файл serliazers.py и описать серилизатор

- Описать ViewSet для работы с моделью.
5. переходим во views.py и описываем

- Описать маршрутизацию.
6. создаем в vehicle файл urls.py
7. добавить include в config/urls.py
8. прописываем путь в vehicle/urls.py
9. запускаем проект
10. переходим в postman

# Задача 2 Generic
Создать модель «Список мотоциклов» и реализовать механизм CRUD на основе Generic.

Шаги решения:
- Создать модель.
1. Создаем модель в vehicle/models
2. создать миграции

- Описать сериализатор.
3. Идем в vehicle/serliazers.py

- Описать контроллеры на основе Generics для каждого действия механизма CRUD.
4. vehicle/views.py

- Описать урлы.
5. vehicle/urls.py

# 30.2 Сериализаторы
# Задача 3 Сериализация
Добавить модель для пробега любого транспортного средства, которая должна включать в себя количество километров и год регистрации пробега.
Для мотоцикла и для машины реализовать возможность добавления пробега.

Шаги решения:
- Создать новую модель.
1. в vehicle/models создаем новую модель пробег
2. применить миграции

- Описать сериализатор.
3. в vehicle/serliazers.py

- Описать ViewSet для работы с моделью.
4. vehicle/views.py описываем либо viewset либо generic. Выбрали generic

- Описать маршрутизацию.
5. vehicle/urls.py
6. проверяем в postman

# Задача 4 Кастомизация сериализаторов
Для мотоцикла и для машины выводить последний записанный пробег.

Решение:
- Расширить сериализаторы машины и мотоцикла.
1. vehicle/serliazers.py добавляем новые поля

# Задача 5 Вывод вложенных объектов
Для запроса информации по машине реализовать вывод списка заполненных пробегов.
Для вывода пробегов мотоциклов реализовать описание объекта мотоцикла, которому принадлежит пробег.

Шаги решения:
- Прописать новое поле для сериализатора машины.
1. vehicle/serliazers.py class MilageSerializer выносим наверх
2. добавляем новое поле в CarSerializer

- Создать новый сериализатор для более корректного отображения данных.
3. vehicle/views.py
4. vehicle/serliazers.py

- Описать необходимые сериализаторы для пробега мотоциклов.

- Создать новый эндпоинт для вывода пробегов мотоциклов (урлы и контроллеры).
5. vehicle/urls.py

# Задача 6 Создание вложенных объектов
Реализовать добавление пробега вместе с добавлением мотоцикла и машины.

Шаги решения:
- Добавить новый сериализатор для конкретной задачи.
1. vehicle/serliazers.py и создаем отдельный серилизатор
2. vehicle/models.py в модель class Milage добавить related_name='milage'

- Переопределить метод create для нового сериализатора.
3. vehicle/serliazers.py переопределяем метод def create в class CarCreateSerializer
4. vehicle/views.py class MotoCreateAPIView

# Задача 7 Фильтрация
Реализовать эндпоинт для получения пробегов и добавить фильтрацию:
- выводить список только пробегов для машин,
- выводить список только пробегов для мотоциклов,
- изменять последовательность сортировки по году пробега.

Шаги решения:

- Установить пакет django-filter.
1. vehicle/views.py Создать новый контроллер для вывода списков пробега
2. vehicle/urls.py описать путь
3. устанавливаем django-filter poetry add django-filter
4. добавить в installed_apps

- Описать класс-фильтр для фильтрации данных.
- Описать атрибуты контроллера для изменения порядка сортировки.
5. добавить импорт OrderingFilter
6. vehicle/views.py добавить сортировку в class MilageListAPIView

# урок 31 Права доступа в DRF
# Задача 8 JWT
Для проекта с транспортом добавить авторизацию JWT и реализовать эндпоинты для авторизации.

Шаги решения:
- Установить пакет simple-jwt .
8.1 pip3 install djangorestframework-simplejwt

- Внести необходимые настройки.
8.2 config/settings добавить REST_FRAMEWORK

- Описать URL для авторизации.
8.3 users/urls.py добавляем импорты из документации djangorestframework-simplejwt
8.4 config/urls.py добавить путь
8.5 postman POST http://127.0.0.1:8000/users/token/

- Создать кастомную модель пользователя (опционально).
ранее была создана
8.6 так как пользователь ранее не создан, создаем его: 
python3 manage.py createsuperuser
Username: admin1
Email adress: опционально
Password: 123qwe
Password again: 123qwe 

# Задача 9 Права на контроллер
Описать права доступа к сервису только авторизованных пользователей.

Шаги решения:
- Описать права доступа для каждого отдельного эндпоинта.
или
9.1 добавляем в config/settings  в REST_FRAMEWORK настройки 
9.2 копируем "acess" из http://127.0.0.1:8000/users/token/

- Описать права доступа для всех эндпоинтов в одном месте.
9.3 добавляем в config/settings  в REST_FRAMEWORK настройки
9.4 Authorization postman дб выключена
9.5 vehicle/views.py class CarViewSet добавляем permission_classes
9.6 в postman активируем  Authorization и отправляем запрос

# Задача 10 Права на модель    
Для моделей мотоцикла и машины добавить поле владельца.
Описать проверку прав доступа для владельца объекта.
Дополнить проверку прав доступа на объект у менеджера (is_staff).

Шаги решения:
- Расширить модель машины и мотоцикла.
10.1 добавляем owner в vehicle/models.py в модели Car, Moto
10.2 миграции

- Добавить автоматическое сохранение владельца при создании объекта.
10.3 пример только с мотоциклом. Переопределяем метод def perform_create

- Создать отдельный класс проверки прав доступа на владельца.
- - Расширить права доступа для менеджера в классе прав доступа.
10.4 добавляем permission_classes в class MotoUpdateAPIView
10.5 создаем файл permissions в vehicle и описываем его
10.6 создадим второго пользователя и сделаем права is_staff=False через shell

# 32.1 Валидаторы, пагинация и тесты
# Задача 11 Валидаторы
Для эндпоинта создания машин и мотоциклов описать валидатор, который проверяет, что название модели состоит только из букв, цифр и символов: точка, тире и пробел.
Для эндпоинта создания машины и мотоцикла описать валидацию на проверку уникальности.

Шаги решения:
- Описать класс или функцию валидатора.
- Заложить в валидаторе логику проверки условия.
11.1 создаем файл validators в vehicle и описываем класс

- Прописать валидатор к необходимому полю.
11.2 vehicle/serliazers.py class MotoCreateSerializer добавляем валидатор
11.3 vehicle/serliazers.py class MotoCreateSerializer добавляем на проверку уникальности
Чтобы данные в title и description были уникальны, стоит реализовать логику в моделях:
title = models.CharField(max_length=200, unique=True)
description = models.TextField(unique=True)

# Задача 12 Пагинация
Реализовать пагинацию для всех эндпоинтов, которые отвечают за вывод списка сущностей.

Шаги решения:
- Описать класс пагинации.
11.5 добавить файл paginators и описать 

- Добавить класс пагинации к классу вывода списка сущностей.
11.4 vehicle/views добавляем в класс class MotoListAPIView

# Задача 12 Тесты
Необходимо обложить тестами один эндпоинт создания сущности и один эндпоинт отображения списка или одной сущности.
Посчитать покрытие тестами.

Шаги решения:
- Описать класс тест-кейса.
- - Описать метод для тестируемого эндпоинта.
- Описать сравнение получаемого результата.
- Установить библиотеку coverage и проверить покрытие тестами.
11.5 vehicle/ tests.py
11.6 запуск теста python3 manage.py test. Тест выпадет в ошибку тк пользователь  не авторизован
можно исправить изменив vehicle/views.py в class CarViewSet
также добавить vehicle/ serializers.py read_only=True в class CarSerializer 

# Задача 12 Документирование и безопасность
Подключить drf-yasg.
Настроить документацию для проекта.

Шаги решения:
- Установить пакет.
11.7 устанавливаем пакет pip install -U drf-yasg
11.8 добавляем "drf_yasg" в settings.py INSTALLED_APPS
11.9 добавить в config/urls.py 
11.20 переходим http://127.0.0.1:8000/swagger/

- Настроить файл URL для отображения документации Swagger.
- Описать эндпоинт.
- Описать маршрутизацию для эндпоинта.
- Добавить описание эндпоинта для вывода в документации.